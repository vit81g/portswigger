SSRF attacks against other back-end systems

SSRF-атаки на другие серверные системы

В некоторых случаях сервер приложений может взаимодействовать с серверными системами, к которым пользователи не имеют прямого доступа. Эти системы часто имеют немаршрутизируемые частные IP-адреса. Серверные системы обычно защищены топологией сети, поэтому они часто имеют более слабый уровень безопасности. Во многих случаях внутренние серверные системы содержат конфиденциальные функции, доступ к которым может получить без аутентификации любой, кто может взаимодействовать с системами.

В предыдущем примере предположим, что по внутреннему URL-адресу https://192.168.0.68/admin имеется административный интерфейс. Злоумышленник может отправить следующий запрос, чтобы воспользоваться уязвимостью SSRF и получить доступ к административному интерфейсу:

POST /product/stock HTTP/1.0
Content-Type: application/x-www-form-urlencoded
Content-Length: 118

stockApi=http://192.168.0.68/admin


В этой лаборатории есть функция проверки запасов, которая извлекает данные из внутренней системы.

Чтобы решить лабораторную работу, используйте функцию проверки запасов для сканирования внутреннего диапазона 192.168.0.X на наличие интерфейса администратора на порту 8080, а затем используйте ее для удаления пользователя carlos.

Решение:

     Посетите продукт, нажмите «Check stock», перехватите запрос в Burp Suite и отправьте его в Burp Intrumer.
     Нажмите «Clear §», измените параметр stockApi на http://192.168.0.1:8080/admin, затем выделите последний октет IP-адреса (the number 1), нажмите «Add §».
     Перейдите на вкладку «Payloads», измените тип полезных данных на «Numbers» и введите 1, 255 и 1 в полях «From», «To» и «Step» соответственно.
     Нажмите «Start attack».
     Нажмите на столбец «Status», чтобы отсортировать его по возрастанию кода статуса. Вы должны увидеть одну запись со статусом 200, показывающую интерфейс администратора.
     Нажмите на этот запрос, отправьте его в Burp Repeater и измените путь в stockApi на: /admin/delete?username=carlos.
     
Solution:
1. start Burp Suite
2. Зайти в любой товар (View), нажать Check stock
3. передать данные в Intruder
Настройка полезной нагрузки: 
Payload set : 1
Payload type : Numbers

From : 1
To : 255
Step : 1

Ждем ответа Status code равного 200, с этого IP можно зайти в панель admin
ПКМ на эту строчку и выбираем Send to Repeater

4. Создастся готовый запрос. Жми Send
stockApi=http://192.168.0.149:8080/admin

5. Разбираем полученый ответ:
находим ссылки на действия админа. Нас интересует удаление carlos
   <span>carlos - </span>
   <a href="/http://192.168.0.149:8080/admin/delete?username=carlos">Delete</a>
   
6. Добавляем эту ссылку в stockApi и жмем Send
   
